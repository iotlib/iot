/*!
 * Start Bootstrap - SB Admin v4.0.0-beta (https://startbootstrap.com/template-overviews/sb-admin)
 * Copyright 2013-2017 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-sb-admin/blob/master/LICENSE)
 */
!function(n){function e(e){console.log("posting:",e),n.post("/api/exec",JSON.stringify(e),function(n){console.log("api cmd response:",n)},"json")}function i(){o()}function o(){var e=n(".page-section-devices");e.empty();var i=n(".template-devicecard").html();Profile.devices.forEach(function(o){console.log("device:",o);var a=o.lastseen-(new Date).getTime()<60,l=n(i.formatUnicorn({title:o.name,deviceid:o.id.substr(0,7),online:a?"online":offline,id:"device-"+o.id}));e.append(l),l.find(".btn-add-function").on("click",function(n){console.log("hi"),t(o).hide().appendTo(l.find("ul")).slideDown()})}),null!==Profile.functions&&Profile.functions.forEach(function(e){var i="device-"+e.deviceid,o=n("#"+i);try{a(e).appendTo(o.find("ul"))}catch(n){console.log("No such device:",i,n)}})}function t(e){function i(){a.slideUp(a.remove)}var o=n(".template-functionline").html(),t=n(o),a=n(t.closest("li.list-group-item"));return console.log("fl:",a),t.find(".btn-cancel").click(function(){i()}),t.find(".btn-save").click(function(){console.log("saving...");var o={name:a.find(".function-name").val(),pin:parseInt(a.find(".function-pin").val()),cmd:"DW",deviceid:e.id,data:{uielement:a.find(".function-dw-type").val(),invert:a.find(".function-dw-invert").is(":checked")}};console.log("func:",o),n.post("/api/newfunction",JSON.stringify(o),function(n){console.log("api newfunction response:",n)},"json"),i()}),t}function a(i){console.log("newfunc!");var o=n('<li class="list-group-item"><span class="text-muted align-middle">{name}</span>\n  <div class="switch">\n    <label>\n      <input id="lightswitch" type="checkbox" checked="checked"/><span class="slider round"></span>\n    </label>\n  </div>\n</li>'.formatUnicorn({name:i.name}));return o.find("input").change(function(n){console.log("Clicked",this.checked),e({id:i.deviceid,cmd:"DW {pin} {val}".formatUnicorn({pin:i.pin,val:this.checked^i.data.invert?"HIGH":"LOW"})})}),o}function l(){n("#navbarResponsive").collapse("hide"),n(".tooltip.navbar-sidenav-tooltip.fade.bs-tooltip-right.show").hide()}function c(e){n(".page-section").hide();n(".page-section-"+e).show();var i=n("li[data-nav-target="+e+"]").text();n(".navbar-brand").text(i),l()}String.prototype.formatUnicorn=function(){var n=this.toString();if(arguments.length){var e,i=typeof arguments[0],o="string"===i||"number"===i?Array.prototype.slice.call(arguments):arguments[0];for(e in o)n=n.replace(new RegExp("\\{"+e+"\\}","gi"),o[e])}return n},c("devices"),n.getJSON("/api/profile",function(n){console.log("Json resp:",n),window.Profile=n,console.log(JSON.stringify(n," "," ")),i()}),n("#nav-signout").click(function(n){l()}),n("li[data-nav-target]").click(function(e){e.preventDefault(),c(n(this).attr("data-nav-target"))}),n('.navbar-sidenav [data-toggle="tooltip"]').tooltip({template:'<div class="tooltip navbar-sidenav-tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'}),n("#sidenavToggler").click(function(e){e.preventDefault(),n("body").toggleClass("sidenav-toggled"),n(".navbar-sidenav .nav-link-collapse").addClass("collapsed"),n(".navbar-sidenav .sidenav-second-level, .navbar-sidenav .sidenav-third-level").removeClass("show")}),n(".navbar-sidenav .nav-link-collapse").click(function(e){e.preventDefault(),n("body").removeClass("sidenav-toggled")}),n("body.fixed-nav .navbar-sidenav, body.fixed-nav .sidenav-toggler, body.fixed-nav .navbar-collapse").on("mousewheel DOMMouseScroll",function(n){var e=n.originalEvent,i=e.wheelDelta||-e.detail;this.scrollTop+=30*(i<0?1:-1),n.preventDefault()}),n(document).scroll(function(){n(this).scrollTop()>100?n(".scroll-to-top").fadeIn():n(".scroll-to-top").fadeOut()}),n('[data-toggle="tooltip"]').tooltip(),n(document).on("click","a.scroll-to-top",function(e){var i=n(this);n("html, body").stop().animate({scrollTop:n(i.attr("href")).offset().top},1e3,"easeInOutExpo"),e.preventDefault()})}(jQuery);